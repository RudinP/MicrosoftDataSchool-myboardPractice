{% extends 'base.html' %}
{% block title %}FMS ë°ì´í„° ë¶„ì„{% endblock %}
{% block content %}

<div class="flex items-center justify-between mb-6">
  <h2 class="text-2xl font-bold text-gray-800">
    FMS ë°ì´í„° ë¶„ì„ & ì‹œê°í™”
  </h2>
  <a
    href="{{ url_for('fms_result') }}"
    class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition-colors shadow-sm"
  >
    <span class="mr-2">ğŸ“„</span> í†µí•© ê²°ê³¼ í…Œì´ë¸”ë¡œ ëŒì•„ê°€ê¸°
  </a>
</div>

<div class="grid gap-8 lg:grid-cols-2">
  <!-- í’ˆì¢…ë³„ ë¶„í¬ íŒŒì´ ì°¨íŠ¸ -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">
      í’ˆì¢…ë³„ ì¶œí•˜ ë¹„ìœ¨
    </h3>
    <p class="text-sm text-gray-500 mb-4">
      ì „ì²´ ì¶œí•˜ ë¬¼ëŸ‰ ì¤‘ ê° í’ˆì¢…ì´ ì°¨ì§€í•˜ëŠ” ë¹„ìœ¨ì…ë‹ˆë‹¤.
    </p>
    <div class="relative h-72">
      <canvas id="breedPieChart"></canvas>
    </div>
  </div>

  <!-- í’ˆì¢…ë³„ Pass / Fail ë§‰ëŒ€ ì°¨íŠ¸ -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">
      í’ˆì¢…ë³„ Pass / Fail ë¶„í¬
    </h3>
    <p class="text-sm text-gray-500 mb-4">
      í’ˆì¢…ë³„ë¡œ í•©ê²©/ë¶€ì í•© ë¬¼ëŸ‰ì´ ì–´ë–»ê²Œ ë¶„í¬í•˜ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.
    </p>
    <div class="relative h-72">
      <canvas id="passFailBarChart"></canvas>
    </div>
  </div>
</div>

<!-- ë‚ ì§œë³„ ì¶œí•˜ ì¶”ì´ ë¼ì¸ ì°¨íŠ¸ -->
<div class="bg-white rounded-lg shadow-md p-6 mt-8">
  <h3 class="text-lg font-semibold text-gray-800 mb-4">
    ë‚ ì§œë³„ ì¶œí•˜ ì¶”ì´
  </h3>
  <p class="text-sm text-gray-500 mb-4">
    ë„ì°©ì¼ ê¸°ì¤€ìœ¼ë¡œ ì¼ë³„ ì¶œí•˜ ë§ˆë¦¿ìˆ˜ ë³€í™”ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </p>
  <div class="relative h-80">
    <canvas id="dailyLineChart"></canvas>
  </div>
  </div>
</div>

<!-- ë°°ì†¡ í˜„í™© ì§€ë„ -->
<div class="bg-gradient-to-r from-pink-100 via-indigo-50 to-teal-100 rounded-2xl p-6 mt-10 shadow-sm">
  <h3 class="text-lg font-semibold text-gray-800 mb-2">
    ğŸšš ê³ ê°ì‚¬ / ë„ì°©ì§€ ê¸°ì¤€ ë°°ì†¡ í˜„í™© ì§€ë„
  </h3>
  <p class="text-sm text-gray-700 mb-4">
    í•œêµ­ ì£¼ìš” ë„ì‹œ ê¸°ì¤€ìœ¼ë¡œ ë°°ì†¡ ë„ì°©ì§€ì™€ ê³ ê°ì‚¬ë³„ ì¶œí•˜ ê±´ìˆ˜ë¥¼
    <span class="font-semibold text-pink-500">íŒŒìŠ¤í…”í†¤ ë²„ë¸”</span>ë¡œ í‘œí˜„í–ˆìŠµë‹ˆë‹¤.
  </p>
  <div class="bg-white rounded-2xl shadow-md p-3 border border-pink-100">
    <div class="w-full rounded-xl overflow-hidden">
      {{ map_html|safe }}
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Flaskì—ì„œ ì „ë‹¬ëœ ë°ì´í„°
  const breedLabels = {{ breed_labels | safe }};
  const breedValues = {{ breed_values | safe }};
  const pfLabels = {{ pf_labels | safe }};
  const pfDatasets = {{ pf_datasets | safe }};
  const dailyLabels = {{ daily_labels | safe }};
  const dailyValues = {{ daily_values | safe }};

  // íŒŒìŠ¤í…”í†¤ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
  const pastelPalette = [
    "#FFB5E8",
    "#B5DEFF",
    "#C7CEEA",
    "#E2F0CB",
    "#FFDAC1",
    "#FF9AA2",
    "#B5EAD7",
    "#E7FFAC",
  ];

  // 1) í’ˆì¢…ë³„ ì¶œí•˜ ë¹„ìœ¨ íŒŒì´ ì°¨íŠ¸
  const breedCtx = document.getElementById("breedPieChart").getContext("2d");
  new Chart(breedCtx, {
    type: "doughnut",
    data: {
      labels: breedLabels,
      datasets: [
        {
          data: breedValues,
          backgroundColor: breedLabels.map(
            (_, i) => pastelPalette[i % pastelPalette.length]
          ),
          borderColor: "#ffffff",
          borderWidth: 2,
        },
      ],
    },
    options: {
      plugins: {
        legend: {
          position: "bottom",
          labels: {
            padding: 16,
          },
        },
      },
      cutout: "55%",
    },
  });

  // 2) í’ˆì¢…ë³„ Pass / Fail ìŠ¤íƒ ë§‰ëŒ€ ì°¨íŠ¸
  const pfCtx = document.getElementById("passFailBarChart").getContext("2d");
  new Chart(pfCtx, {
    type: "bar",
    data: {
      labels: pfLabels,
      datasets: pfDatasets,
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: "bottom",
        },
      },
      scales: {
        x: {
          stacked: true,
        },
        y: {
          stacked: true,
          beginAtZero: true,
        },
      },
    },
  });

  // 3) ë‚ ì§œë³„ ì¶œí•˜ ì¶”ì´ ë¼ì¸ ì°¨íŠ¸
  const dailyCtx = document.getElementById("dailyLineChart").getContext("2d");
  new Chart(dailyCtx, {
    type: "line",
    data: {
      labels: dailyLabels,
      datasets: [
        {
          label: "ì¶œí•˜ ë§ˆë¦¿ìˆ˜",
          data: dailyValues,
          backgroundColor: "rgba(181, 222, 255, 0.5)",
          borderColor: "#B5DEFF",
          borderWidth: 2,
          tension: 0.3,
          fill: true,
          pointBackgroundColor: "#FFB5E8",
          pointRadius: 4,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: "bottom",
        },
      },
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
</script>

{% endblock %}

